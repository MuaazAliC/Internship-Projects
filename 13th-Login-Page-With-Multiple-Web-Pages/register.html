<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .password-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        .password-wrapper i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #555;
        }
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .upload-btn {
            border: 2px solid #4CAF50;
            color: white;
            background-color: #4CAF50;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .upload-btn:hover {
            background: linear-gradient(90deg, #0044cc 60%, #1869ff 100%);
            transform: translateY(-2px) scale(1.03);
        }
        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .error-box {
            color: red;
            margin-top: 10px;
        }
        /* Avatar Preview */
        .avatar-preview {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }
        .avatar-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="loader" class="loader" style="display:none;">Loading...</div>
    <div id="errorBox" class="error-box"></div>
    <div id="ok" class="ok"></div>

    <h2>Register</h2>
    <input type="text" id="first_name" placeholder="First Name">
    <input type="text" id="last_name" placeholder="Last Name">
    <input type="email" id="reg_email" placeholder="Email">
    <input type="text" id="username" placeholder="Username">
    <input type="text" id="phone" placeholder="Phone Number">

    <div class="password-wrapper">
        <input type="password" id="reg_password" placeholder="Password">
        <i class="fa-solid fa-eye" id="toggle_reg_password"></i>
    </div>

    <div class="password-wrapper">
        <input type="password" id="confirm_password" placeholder="Confirm Password">
        <i class="fa-solid fa-eye" id="toggle_confirm_password"></i>
    </div>

    <div class="upload-btn-wrapper">
        <button class="upload-btn"><i class="fa-solid fa-upload"></i> Upload Profile Image</button>
        <input type="file" id="profile_image" accept="image/*">
    </div>

    <!-- Avatar Preview -->
    <div class="avatar-preview" id="avatarPreview" style="display:none;">
        <img id="avatarImage" src="" alt="Avatar Preview">
    </div>

    <br><br>
    <button id="verifi_btn">Verification</button> 
    <p><a href="login.html">Already have an account? Login</a></p>
</div>

<script>
    function togglePasswordVisibility(inputId, iconId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        icon.addEventListener("click", () => {
            const isPassword = input.type === "password";
            input.type = isPassword ? "text" : "password";
            icon.classList.toggle("fa-eye", !isPassword);
            icon.classList.toggle("fa-eye-slash", isPassword);
        });
    }
    togglePasswordVisibility("reg_password", "toggle_reg_password");
    togglePasswordVisibility("confirm_password", "toggle_confirm_password");

    function showError(msg) {
        const box = document.getElementById("errorBox");
        box.innerText = msg;
        box.style.display = "block";
        setTimeout(() => box.style.display = "none", 5000);
    }

    const verifi_btn = document.getElementById("verifi_btn");
    const reg_email = document.getElementById("reg_email");
    const firstName = document.getElementById("first_name");
    const lastName = document.getElementById("last_name");
    const userName = document.getElementById("username");
    const phoneNumber = document.getElementById("phone");
    const password = document.getElementById("reg_password");
    const confirmPassword = document.getElementById("confirm_password");
    const profileImage = document.getElementById("profile_image");

   
    profileImage.addEventListener("change", () => {
        const file = profileImage.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById("avatarImage").src = e.target.result;
                document.getElementById("avatarPreview").style.display = "flex";
            };
            reader.readAsDataURL(file);
        }
    });

    verifi_btn.addEventListener("click", () => {
        if (
            reg_email.value.trim() &&
            firstName.value.trim() &&
            lastName.value.trim() &&
            userName.value.trim() &&
            phoneNumber.value.trim() &&
            password.value.trim() &&
            confirmPassword.value.trim()
        ) {
            if (password.value !== confirmPassword.value) {
                return showError("Passwords do not match.");
            }
            const usernameRegex = /^(?!.*\s)(?=.*_)[A-Za-z0-9_]{3,}$/;
            if (!usernameRegex.test(userName.value))
                return showError("Username must have no spaces, contain _, and be at least 3 characters.");

            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
            if (!passwordRegex.test(password.value))
                return showError("Password must be 8+ characters, include uppercase, lowercase, number, and special char.");

            if (!profileImage.files[0]) {
                return showError("Please select a profile image.");
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const formData = {
                    first_name: firstName.value.trim(),
                    last_name: lastName.value.trim(),
                    email: reg_email.value.trim(),
                    username: userName.value.trim(),
                    phone: phoneNumber.value.trim(),
                    password: password.value,
                    confirm_password: confirmPassword.value,
                    image_base64: e.target.result
                };
                localStorage.setItem("pendingRegisterData", JSON.stringify(formData));
                window.location.href = "otp_send.html";
            };
            reader.readAsDataURL(profileImage.files[0]);
        } else {
            showError("Please fill all fields.");
        }
    });
</script>
</body>
</html>
